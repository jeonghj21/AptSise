<script>
var myChart = null;
var defaultDataset = [{
                fillColor : "rbga(151,187,205,0.2)",
                strokeColor : "rbga(151,187,205,1)",
                pointColor : "rbga(151,187,205,1)",
                pointStrokeColor : "#fff",
                pointHighlightFill : "#fff",
                pointHighlightStroke : "rbga(151,187,205,1)"
            }];

var defaultOptions = {
  scales: {
    yAxes: [{
      id: 'A',
      type: 'linear',
      position: 'left',
    }, {
      id: 'B',
      type: 'linear',
      position: 'right',
    }]
  }
};

function drawChart(title, labels, data){
  var ctx = document.getElementById("myChart").getContext("2d");
  if (myChart != null) {
    myChart.destroy();
  }
  myChart = new Chart (ctx, {
    type: 'line',
    data: {
      labels : labels,
      datasets : [{ 
        label: '평단가 - ' + title,
        yAxisID: 'A',
        pointColor: 'blue',
        strokeColor: 'blue',
        data: data,
        spanGaps: true
      }]
    },
    options : {
      scales: {
        yAxes: [{
          id: 'A',
          type: 'linear',
          position: 'left'
        }]
      }
    }
  }); 

  document.getElementById("myChart").onclick = function(evt) {
    var activePoint = myChart.getElementAtEvent(event);

    // make sure click was on an actual point
    if (activePoint.length > 0) {
      var clickedDatasetIndex = activePoint[0]._datasetIndex;
      var clickedElementindex = activePoint[0]._index;
      var label = myChart.data.labels[clickedElementindex];
      var value = myChart.data.datasets[clickedDatasetIndex].data[clickedElementindex];     
    }
  };
}

</script>

{% include 'style.html' %}
{% include 'container.html' %}
<div style='width:100%; margin:20px;'>
    <canvas id="myChart"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script>

function drawSaleLineChart(apt, title) {
  $.getJSON("{{ config['BASE_URL'] }}getSale?apt="+apt, function(jsonData){
    data = JSON.parse(jsonData);
    drawChart(title, data['labels'], data['data']);
  });

}

function drawSaleStat(from_ym, to_ym, ages, age_sign, area_type, region, dong, title) {
  params = "from_ym=" + from_ym;
  params += "&to_ym=" + to_ym;
  params += "&ages=" + ages;
  params += "&age_sign=" + age_sign;
  params += "&area_type=" + area_type;
  params += "&region=" + region;
  params += "&dong=" + dong;

  if (from_ym + to_ym + ages + area_type != "") {
    needsComma = false;
    title += " (";
    if (from_ym + to_ym != ""){
      title += "기간 : " + from_ym + " ~ " + to_ym;
      needsComma = true;
    }
    if (ages != ""){
      if (needsComma) title += ", ";
      title += "연식 : " + ages + " 년 " + (age_sign == '<' ? "이내" : "이상");
      needsComma = true;
    }
    if (area_type != ""){
      if (needsComma) title += ", ";
      title += "전용면적 : " + (area_type == '00' ? "42" : (area_type == '01' ? "84" : (area_type == '02' ? "128" : (area_type == '03' ? "180" : "180 제곱미터 초과"))))
      if (title.slice(-2) != "초과") title += " 제곱미터 이하";
    }
    title += ")";
  }

  $.getJSON("{{ config['BASE_URL'] }}getSaleStat?" + params, function(jsonData){
    data = JSON.parse(jsonData);
    drawChart(title, data['labels'], data['data']);
  });
}

</script>
{% include 'bottom.html' %}

